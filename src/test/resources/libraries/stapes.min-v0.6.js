/*! Stapes.js v0.6 < http://hay.github.com/stapes > */
(function(){"use strict";var a="0.6",b=1,c=function(){},d={attributes:{},eventHandlers:{"-1":{}},guid:-1,addEvent:function(a){d.eventHandlers[a.guid][a.type]||(d.eventHandlers[a.guid][a.type]=[]),d.eventHandlers[a.guid][a.type].push({guid:a.guid,handler:a.handler,scope:a.scope,type:a.type})},addEventHandler:function(a,b,c){var e={},f;typeof a=="string"?(f=c||!1,e[a]=b):(f=b||!1,e=a);for(var g in e){var h=e[g],i=g.split(" ");for(var j=0,k=i.length;j<k;j++){var l=i[j];d.addEvent.call(this,{guid:this._guid||this._.guid,handler:h,scope:f,type:l})}}},addGuid:function(a,c){if(!a._guid||!!c)a._guid=b++,d.attributes[a._guid]={},d.eventHandlers[a._guid]={}},attr:function(a){return d.attributes[a]},clone:function(a){return d.extend({},a)},create:function(a){c.prototype=a;return new c},createModule:function(a){var b=d.create(a);d.addGuid(b,!0),f.mixinEvents(b);return b},emitEvents:function(a,b,c,e){c=c||!1,e=e||this._guid;var f=d.eventHandlers[e][a];for(var g=0,h=f.length;g<h;g++){var i=d.extend({},f[g]),j=i.scope?i.scope:this;c&&(i.type=c),i.scope=j,i.handler.call(i.scope,b,i)}},extend:function(a,b){for(var c in b)a[c]=b[c];return a},makeUuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=Math.random()*16|0,c=a=="x"?b:b&3|8;return c.toString(16)})},removeAttribute:function(a,b){b=b||!1,delete d.attr(this._guid)[a];if(b)return this;this.emit("change",a),this.emit("change:"+a),this.emit("remove",a),this.emit("remove:"+a)},removeEventHandler:function(a,b){var c=d.eventHandlers[this._guid];if(a&&b){c=c[a];if(!c)return;for(var e=0,f=c.length,g;e<f;e++)g=c[e].handler,g&&g===b&&(c.splice(e--,1),f--)}else a?delete c[a]:d.eventHandlers[this._guid]={}},setAttribute:function(a,b,c){c=c||!1;var e=this.has(a),f=d.attr(this._guid)[a];if(b!==f){d.attr(this._guid)[a]=b;if(c)return;this.emit("change",a),this.emit("change:"+a,b);var g={key:a,newValue:b,oldValue:f||null};this.emit("mutate",g),this.emit("mutate:"+a,g);var h=e?"update":"create";this.emit(h,a),this.emit(h+":"+a,b)}},typeOf:function(a){return Object.prototype.toString.call(a).replace(/\[object |\]/g,"").toLowerCase()},updateAttribute:function(a,b){var c=this.get(a),e=b(d.clone(c));d.setAttribute.call(this,a,e)}},e={emit:function(a,b){b=typeof b=="undefined"?null:b;var c=a.split(" ");for(var e=0,f=c.length;e<f;e++){var g=c[e];d.eventHandlers[-1].all&&d.emitEvents.call(this,"all",b,g,-1),d.eventHandlers[-1][g]&&d.emitEvents.call(this,g,b,g,-1),typeof this._guid=="number"&&(d.eventHandlers[this._guid].all&&d.emitEvents.call(this,"all",b,g),d.eventHandlers[this._guid][g]&&d.emitEvents.call(this,g,b))}},off:function(){d.removeEventHandler.apply(this,arguments)},on:function(){d.addEventHandler.apply(this,arguments)}};d.Module={create:function(){return d.createModule(this)},each:function(a,b){var c=d.attr(this._guid);for(var e in c){var f=c[e];a.call(b||this,f,e)}},extend:function(a,b){var c=b?a:this,e=b?b:a;d.extend(c,e);return this},filter:function(a){var b=[],c=d.attr(this._guid);for(var e in c)a.call(this,c[e],e)&&b.push(c[e]);return b},get:function(a){if(typeof a=="string")return this.has(a)?d.attr(this._guid)[a]:null;if(typeof a=="function"){var b=this.filter(a);return b.length?b[0]:null}},getAll:function(){return d.clone(d.attr(this._guid))},getAllAsArray:function(){var a=[],b=d.attr(this._guid);for(var c in b){var e=b[c];d.typeOf(e)==="object"&&(e.id=c),a.push(e)}return a},has:function(a){return typeof d.attr(this._guid)[a]!="undefined"},push:function(a,b){if(d.typeOf(a)==="array")for(var c=0,e=a.length;c<e;c++)d.setAttribute.call(this,d.makeUuid(),a[c]);else d.setAttribute.call(this,d.makeUuid(),a,b||!1);return this},remove:function(a,b){typeof a=="function"?this.each(function(c,e){a(c)&&d.removeAttribute.call(this,e,b)}):d.removeAttribute.call(this,a,b||!1);return this},set:function(a,b,c){if(typeof a=="object")for(var e in a)d.setAttribute.call(this,e,a[e]);else d.setAttribute.call(this,a,b,c||!1);return this},size:function(){return Object.keys(d.attributes[this._guid]).length},update:function(a,b){typeof a=="string"?d.updateAttribute.call(this,a,b):typeof a=="function"&&this.each(function(b,c){d.updateAttribute.call(this,c,a)});return this}};var f={_:d,create:function(){return d.createModule(d.Module)},extend:function(a){return d.extend(d.Module,a)},mixinEvents:function(a){a=a||{},d.addGuid(a);return d.extend(a,e)},on:function(){d.addEventHandler.apply(this,arguments)},version:a};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=f),exports.Stapes=f):typeof define=="function"&&define.amd?define(function(){return f}):window.Stapes=f})()