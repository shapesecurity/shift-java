// Stapes.js v0.4 - (c) Hay Kranen, released under the MIT license - http://hay.github.com/stapes
(function(){function i(a,c){var d=this.get(a),e=c(b.clone(d));h.call(this,a,e)}function h(a,b){var c=this.has(a),d=e(this._guid)[a];if(b!==d){e(this._guid)[a]=b,this.emit("change",a),this.emit("change:"+a,b);var f={key:a,newValue:b,oldValue:d||null};this.emit("mutate",f),this.emit("mutate:"+a,f);var g=c?"update":"create";this.emit(g,a),this.emit(g+":"+a,b)}}function g(a,c,d,e){d=d||!1,e=e||this._guid,b.each(l._eventHandlers[e][a],function(a){var b=a.scope?a.scope:this;d&&(a.type=d),a.scope=b,a.handler.call(a.scope,c,a)},this)}function f(a){var c=b.create(a);c._guid=j++,l._attributes[c._guid]={},l._eventHandlers[c._guid]={};return c}function e(a){return l._attributes[a]}function d(a,d,e){var f={},g;typeof a=="string"?(g=e||!1,f[a]=d):(g=d||!1,f=a),b.each(f,function(a,d){var e=d.split(" ");b.each(e,function(b){c.call(this,{guid:this._guid,handler:a,scope:g,type:b})},this)},this)}function c(a){l._eventHandlers[a.guid][a.type]||(l._eventHandlers[a.guid][a.type]=[]),l._eventHandlers[a.guid][a.type].push({guid:a.guid,handler:a.handler,scope:a.scope,type:a.type})}"use strict";var a="0.4",b={bind:function(a,b){return Function.prototype.bind?a.bind(b):function(){return a.apply(b,arguments)}},clone:function(a){if(b.isArray(a))return a.slice();if(b.isObject(a)){var c={};b.each(a,function(a,b){c[b]=a});return c}return a},create:function(a){var b;if(typeof Object.create=="function")b=Object.create(a);else{var c=function(){};c.prototype=a,b=new c}return b},each:function(a,c,d){if(b.isArray(a))if(Array.prototype.forEach)a.forEach(c,d);else for(var e=0,f=a.length;e<f;e++)c.call(d,a[e],e);else for(var g in a)c.call(d,a[g],g)},filter:function(a,c,d){var e=[];if(b.isArray(a)&&Array.prototype.filter)return a.filter(c,d);b.each(a,function(a){c.call(d,a)&&e.push(a)});return e},isArray:function(a){return b.typeOf(a)==="array"},isObject:function(a){return b.typeOf(a)==="object"},keys:function(a){return b.map(a,function(a,b){return b})},makeUuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=Math.random()*16|0,c=a=="x"?b:b&3|8;return c.toString(16)})},map:function(a,c,d){var e=[];if(b.isArray(a)&&Array.prototype.map)return a.map(c,d);b.each(a,function(a,b){e.push(c.call(d,a,b))});return e},size:function(a){return b.isArray(a)?a.length:b.keys(a).length},toArray:function(a){return b.isObject(a)?b.values(a):Array.prototype.slice.call(a,0)},typeOf:function(a){return Object.prototype.toString.call(a).replace(/\[object |\]/g,"").toLowerCase()},values:function(a){return b.map(a,function(a,b){return a})}},j=1,k={create:function(){return f(this)},each:function(a,c){b.each(e(this._guid),a,c||this)},emit:function(a,c){c=typeof c=="undefined"?null:c,b.each(a.split(" "),function(a){l._eventHandlers[-1].all&&g.call(this,"all",c,a,-1),l._eventHandlers[-1][a]&&g.call(this,a,c,a,-1),typeof this._guid=="number"&&(l._eventHandlers[this._guid].all&&g.call(this,"all",c,a),l._eventHandlers[this._guid][a]&&g.call(this,a,c))},this)},extend:function(a,c){var d=c?a:this,e=c?c:a;b.each(e,function(a,b){d[b]=a});return this},filter:function(a){return b.filter(e(this._guid),a)},get:function(a){if(typeof a=="string")return this.has(a)?e(this._guid)[a]:null;if(typeof a=="function"){var b=this.filter(a);return b.length?b[0]:null}},getAll:function(){return b.clone(e(this._guid))},getAllAsArray:function(){var a=b.map(e(this._guid),function(a,c){b.isObject(a)&&(a.id=c);return a});return b.clone(a)},has:function(a){return typeof e(this._guid)[a]!="undefined"},on:function(){d.apply(this,arguments)},push:function(a){b.isArray(a)?b.each(a,function(a){h.call(this,b.makeUuid(),a)},this):h.call(this,b.makeUuid(),a)},remove:function(a){typeof a=="function"?this.each(function(b,c){a(b)&&(delete e(this._guid)[c],this.emit("remove change"))}):this.has(a)&&(delete e(this._guid)[a],this.emit("remove change"))},set:function(a,c){b.isObject(a)?b.each(a,function(a,b){h.call(this,b,a)},this):h.call(this,a,c)},size:function(){return b.size(l._attributes[this._guid])},update:function(a,b){typeof a=="string"?i.call(this,a,b):typeof a=="function"&&this.each(function(b,c){i.call(this,c,a)})}},l={_attributes:{},_eventHandlers:{"-1":{}},_guid:-1,create:function(){return f(k)},extend:function(a){b.each(a,function(a,b){k[b]=a})},on:function(){d.apply(this,arguments)},util:b,version:a};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=l),exports.Stapes=l):typeof define=="function"&&define.amd?define(function(){return l}):window.Stapes=l})()