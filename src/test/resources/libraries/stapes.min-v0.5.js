// Stapes.js v0.5 - (c) Hay Kranen, released under the MIT license - http://hay.github.com/stapes
(function(){function l(a,b){var d=this.get(a),e=b(c.clone(d));k.call(this,a,e)}function k(a,b){var c=this.has(a),d=g(this._guid)[a];if(b!==d){g(this._guid)[a]=b,this.emit("change",a),this.emit("change:"+a,b);var e={key:a,newValue:b,oldValue:d||null};this.emit("mutate",e),this.emit("mutate:"+a,e);var f=c?"update":"create";this.emit(f,a),this.emit(f+":"+a,b)}}function j(a,b){var d=o._eventHandlers[this._guid];a&&b?c.each(d[a],function(c,e){c.handler===b&&d[a].splice(e--,1)},this):a?delete d[a]:o._eventHandlers[this._guid]={}}function i(a,b,d,e){d=d||!1,e=e||this._guid,c.each(o._eventHandlers[e][a],function(a){var c=a.scope?a.scope:this;d&&(a.type=d),a.scope=c,a.handler.call(a.scope,b,a)},this)}function h(a){var b=c.create(a);f(b),o.mixinEvents(b);return b}function g(a){return o._attributes[a]}function f(a){a._guid||(a._guid=b++,o._attributes[a._guid]={},o._eventHandlers[a._guid]={})}function e(a,b,e){var f={},g;typeof a=="string"?(g=e||!1,f[a]=b):(g=b||!1,f=a),c.each(f,function(a,b){var e=b.split(" ");c.each(e,function(b){d.call(this,{guid:this._guid,handler:a,scope:g,type:b})},this)},this)}function d(a){o._eventHandlers[a.guid][a.type]||(o._eventHandlers[a.guid][a.type]=[]),o._eventHandlers[a.guid][a.type].push({guid:a.guid,handler:a.handler,scope:a.scope,type:a.type})}"use strict";var a="0.5",b=1,c={bind:function(a,b){if(c.isObject(a)){c.each(a,function(b,d){c.typeOf(b)==="function"&&(a[d]=c.bind(b,a))});return a}return Function.prototype.bind?a.bind(b):function(){return a.apply(b,arguments)}},clone:function(a){if(c.isArray(a))return a.slice();if(c.isObject(a)){var b={};c.each(a,function(a,c){b[c]=a});return b}return a},create:function(a){var b;if(typeof Object.create=="function")b=Object.create(a);else{var c=function(){};c.prototype=a,b=new c}return b},each:function(a,b,d){if(c.isArray(a))if(Array.prototype.forEach)a.forEach(b,d);else for(var e=0,f=a.length;e<f;e++)b.call(d,a[e],e);else for(var g in a)b.call(d,a[g],g)},filter:function(a,b,d){var e=[];if(c.isArray(a)&&Array.prototype.filter)return a.filter(b,d);c.each(a,function(a){b.call(d,a)&&e.push(a)});return e},isArray:function(a){return c.typeOf(a)==="array"},isObject:function(a){return c.typeOf(a)==="object"},keys:function(a){return c.map(a,function(a,b){return b})},makeUuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=Math.random()*16|0,c=a=="x"?b:b&3|8;return c.toString(16)})},map:function(a,b,d){var e=[];if(c.isArray(a)&&Array.prototype.map)return a.map(b,d);c.each(a,function(a,c){e.push(b.call(d,a,c))});return e},size:function(a){return c.isArray(a)?a.length:c.keys(a).length},toArray:function(a){return c.isObject(a)?c.values(a):Array.prototype.slice.call(a,0)},typeOf:function(a){return Object.prototype.toString.call(a).replace(/\[object |\]/g,"").toLowerCase()},values:function(a){return c.map(a,function(a,b){return a})}},m={emit:function(a,b){b=typeof b=="undefined"?null:b,c.each(a.split(" "),function(a){o._eventHandlers[-1].all&&i.call(this,"all",b,a,-1),o._eventHandlers[-1][a]&&i.call(this,a,b,a,-1),typeof this._guid=="number"&&(o._eventHandlers[this._guid].all&&i.call(this,"all",b,a),o._eventHandlers[this._guid][a]&&i.call(this,a,b))},this)},off:function(){j.apply(this,arguments)},on:function(){e.apply(this,arguments)}},n={create:function(){return h(this)},each:function(a,b){c.each(g(this._guid),a,b||this)},extend:function(a,b){var d=b?a:this,e=b?b:a;c.each(e,function(a,b){d[b]=a});return this},filter:function(a){return c.filter(g(this._guid),a)},get:function(a){if(typeof a=="string")return this.has(a)?g(this._guid)[a]:null;if(typeof a=="function"){var b=this.filter(a);return b.length?b[0]:null}},getAll:function(){return c.clone(g(this._guid))},getAllAsArray:function(){var a=c.map(g(this._guid),function(a,b){c.isObject(a)&&(a.id=b);return a});return c.clone(a)},has:function(a){return typeof g(this._guid)[a]!="undefined"},push:function(a){c.isArray(a)?c.each(a,function(a){k.call(this,c.makeUuid(),a)},this):k.call(this,c.makeUuid(),a)},remove:function(a){typeof a=="function"?this.each(function(b,c){a(b)&&(delete g(this._guid)[c],this.emit("remove change"))}):this.has(a)&&(delete g(this._guid)[a],this.emit("remove change"))},set:function(a,b){c.isObject(a)?c.each(a,function(a,b){k.call(this,b,a)},this):k.call(this,a,b)},size:function(){return c.size(o._attributes[this._guid])},update:function(a,b){typeof a=="string"?l.call(this,a,b):typeof a=="function"&&this.each(function(b,c){l.call(this,c,a)})}},o={_attributes:{},_eventHandlers:{"-1":{}},_guid:-1,create:function(){return h(n)},extend:function(a){c.each(a,function(a,b){n[b]=a})},mixinEvents:function(a){a=a||{},f(a),c.each(m,function(b,c){a[c]=b});return a},on:function(){e.apply(this,arguments)},util:c,version:a};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=o),exports.Stapes=o):typeof define=="function"&&define.amd?define(function(){return o}):window.Stapes=o})()