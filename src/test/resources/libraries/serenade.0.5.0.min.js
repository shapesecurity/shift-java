/**
 * Serenade.js JavaScript Framework v0.5.0
 * Revision: bcda813708
 * http://github.com/elabs/serenade.js
 *
 * Copyright 2011, Jonas Nicklas, Elabs AB
 * Released under the MIT License
 */
(function(e){var t=function(){function t(){this.yy={}}var e={trace:function(){},yy:{},symbols_:{error:2,Root:3,ChildList:4,ElementIdentifier:5,AnyIdentifier:6,"#":7,".":8,Element:9,"[":10,"]":11,PropertyList:12,WHITESPACE:13,Text:14,INDENT:15,OUTDENT:16,TextList:17,Bound:18,STRING_LITERAL:19,Child:20,TERMINATOR:21,IfInstruction:22,Instruction:23,Helper:24,Property:25,"=":26,"!":27,":":28,"-":29,VIEW:30,COLLECTION:31,UNLESS:32,IN:33,IDENTIFIER:34,IF:35,ElseInstruction:36,ELSE:37,"@":38,$accept:0,$end:1},terminals_:{2:"error",7:"#",8:".",10:"[",11:"]",13:"WHITESPACE",15:"INDENT",16:"OUTDENT",19:"STRING_LITERAL",21:"TERMINATOR",26:"=",27:"!",28:":",29:"-",30:"VIEW",31:"COLLECTION",32:"UNLESS",33:"IN",34:"IDENTIFIER",35:"IF",37:"ELSE",38:"@"},productions_:[0,[3,0],[3,1],[5,1],[5,3],[5,2],[5,2],[5,3],[9,1],[9,3],[9,4],[9,3],[9,4],[17,1],[17,3],[14,1],[14,1],[4,1],[4,3],[20,1],[20,1],[20,1],[20,1],[20,1],[12,1],[12,3],[25,3],[25,3],[25,4],[25,4],[25,3],[25,3],[23,5],[23,5],[23,5],[23,5],[23,5],[23,4],[24,3],[24,3],[24,4],[22,5],[22,4],[22,2],[36,6],[6,1],[6,1],[6,1],[6,1],[6,1],[6,1],[18,2],[18,1]],performAction:function(t,n,r,i,s,o,u){var a=o.length-1;switch(s){case 1:this.$=null;break;case 2:return this.$;case 3:this.$={name:o[a],classes:[]};break;case 4:this.$={name:o[a-2],id:o[a],classes:[]};break;case 5:this.$={name:"div",id:o[a],classes:[]};break;case 6:this.$={name:"div",classes:[o[a]]};break;case 7:this.$=function(){return o[a-2].classes.push(o[a]),o[a-2]}();break;case 8:this.$={name:o[a].name,id:o[a].id,classes:o[a].classes,properties:[],children:[],type:"element"};break;case 9:this.$=o[a-2];break;case 10:this.$=function(){return o[a-3].properties=o[a-1],o[a-3]}();break;case 11:this.$=function(){return o[a-2].children=o[a-2].children.concat(o[a]),o[a-2]}();break;case 12:this.$=function(){return o[a-3].children=o[a-3].children.concat(o[a-1]),o[a-3]}();break;case 13:this.$=[o[a]];break;case 14:this.$=o[a-2].concat(o[a]);break;case 15:this.$={type:"text",value:o[a],bound:!0};break;case 16:this.$={type:"text",value:o[a],bound:!1};break;case 17:this.$=[].concat(o[a]);break;case 18:this.$=o[a-2].concat(o[a]);break;case 19:this.$=o[a];break;case 20:this.$=o[a];break;case 21:this.$=o[a];break;case 22:this.$=o[a];break;case 23:this.$=o[a];break;case 24:this.$=[o[a]];break;case 25:this.$=o[a-2].concat(o[a]);break;case 26:this.$={name:o[a-2],value:o[a],bound:!0,scope:"attribute"};break;case 27:this.$={name:o[a-2],value:o[a],bound:!0,scope:"attribute"};break;case 28:this.$={name:o[a-3],value:o[a-1],bound:!0,scope:"attribute",preventDefault:!0};break;case 29:this.$={name:o[a-3],value:o[a-1],bound:!0,scope:"attribute",preventDefault:!0};break;case 30:this.$={name:o[a-2],value:o[a],bound:!1,scope:"attribute"};break;case 31:this.$=function(){return o[a].scope=o[a-2],o[a]}();break;case 32:this.$={children:[],type:"view",argument:o[a]};break;case 33:this.$={children:[],type:"view",argument:o[a],bound:!0};break;case 34:this.$={children:[],type:"collection",argument:o[a]};break;case 35:this.$={children:[],type:"unless",argument:o[a]};break;case 36:this.$={children:[],type:"in",argument:o[a]};break;case 37:this.$=function(){return o[a-3].children=o[a-1],o[a-3]}();break;case 38:this.$={command:o[a],arguments:[],children:[],type:"helper"};break;case 39:this.$=function(){return o[a-2].arguments.push(o[a]),o[a-2]}();break;case 40:this.$=function(){return o[a-3].children=o[a-1],o[a-3]}();break;case 41:this.$={children:[],type:"if",argument:o[a]};break;case 42:this.$=function(){return o[a-3].children=o[a-1],o[a-3]}();break;case 43:this.$=function(){return o[a-1]["else"]=o[a],o[a-1]}();break;case 44:this.$={arguments:[],children:o[a-1],type:"else"};break;case 45:this.$=o[a];break;case 46:this.$=o[a];break;case 47:this.$=o[a];break;case 48:this.$=o[a];break;case 49:this.$=o[a];break;case 50:this.$=o[a];break;case 51:this.$=o[a];break;case 52:this.$=function(){}()}},table:[{1:[2,1],3:1,4:2,5:9,6:12,7:[1,13],8:[1,14],9:4,14:11,17:8,18:15,19:[1,16],20:3,22:5,23:6,24:7,29:[1,10],30:[1,17],31:[1,18],32:[1,20],33:[1,21],34:[1,22],35:[1,19],38:[1,23]},{1:[3]},{1:[2,2],21:[1,24]},{1:[2,17],16:[2,17],21:[2,17]},{1:[2,19],10:[1,25],13:[1,26],15:[1,27],16:[2,19],21:[2,19]},{1:[2,20],15:[1,28],16:[2,20],21:[2,20],29:[1,30],36:29},{1:[2,21],15:[1,31],16:[2,21],21:[2,21]},{1:[2,22],13:[1,32],15:[1,33],16:[2,22],21:[2,22]},{1:[2,23],13:[1,34],16:[2,23],21:[2,23]},{1:[2,8],8:[1,35],10:[2,8],13:[2,8],15:[2,8],16:[2,8],21:[2,8]},{13:[1,36]},{1:[2,13],13:[2,13],16:[2,13],21:[2,13]},{1:[2,3],7:[1,37],8:[2,3],10:[2,3],13:[2,3],15:[2,3],16:[2,3],21:[2,3]},{6:38,30:[1,17],31:[1,18],32:[1,20],33:[1,21],34:[1,22],35:[1,19]},{6:39,30:[1,17],31:[1,18],32:[1,20],33:[1,21],34:[1,22],35:[1,19]},{1:[2,15],10:[2,15],13:[2,15],15:[2,15],16:[2,15],21:[2,15]},{1:[2,16],10:[2,16],13:[2,16],15:[2,16],16:[2,16],21:[2,16]},{1:[2,45],7:[2,45],8:[2,45],10:[2,45],11:[2,45],13:[2,45],15:[2,45],16:[2,45],21:[2,45],26:[2,45],27:[2,45],28:[2,45],29:[2,45]},{1:[2,46],7:[2,46],8:[2,46],10:[2,46],11:[2,46],13:[2,46],15:[2,46],16:[2,46],21:[2,46],26:[2,46],27:[2,46],28:[2,46],29:[2,46]},{1:[2,47],7:[2,47],8:[2,47],10:[2,47],11:[2,47],13:[2,47],15:[2,47],16:[2,47],21:[2,47],26:[2,47],27:[2,47],28:[2,47],29:[2,47]},{1:[2,48],7:[2,48],8:[2,48],10:[2,48],11:[2,48],13:[2,48],15:[2,48],16:[2,48],21:[2,48],26:[2,48],27:[2,48],28:[2,48],29:[2,48]},{1:[2,49],7:[2,49],8:[2,49],10:[2,49],11:[2,49],13:[2,49],15:[2,49],16:[2,49],21:[2,49],26:[2,49],27:[2,49],28:[2,49],29:[2,49]},{1:[2,50],7:[2,50],8:[2,50],10:[2,50],11:[2,50],13:[2,50],15:[2,50],16:[2,50],21:[2,50],26:[2,50],27:[2,50],28:[2,50],29:[2,50]},{1:[2,52],6:40,10:[2,52],11:[2,52],13:[2,52],15:[2,52],16:[2,52],21:[2,52],27:[2,52],29:[2,52],30:[1,17],31:[1,18],32:[1,20],33:[1,21],34:[1,22],35:[1,19]},{5:9,6:12,7:[1,13],8:[1,14],9:4,14:11,17:8,18:15,19:[1,16],20:41,22:5,23:6,24:7,29:[1,10],30:[1,17],31:[1,18],32:[1,20],33:[1,21],34:[1,22],35:[1,19],38:[1,23]},{6:45,11:[1,42],12:43,25:44,30:[1,17],31:[1,18],32:[1,20],33:[1,21],34:[1,22],35:[1,19]},{14:46,18:15,19:[1,16],38:[1,23]},{4:47,5:9,6:12,7:[1,13],8:[1,14],9:4,14:11,17:8,18:15,19:[1,16],20:3,22:5,23:6,24:7,29:[1,10],30:[1,17],31:[1,18],32:[1,20],33:[1,21],34:[1,22],35:[1,19],38:[1,23]},{4:48,5:9,6:12,7:[1,13],8:[1,14],9:4,14:11,17:8,18:15,19:[1,16],20:3,22:5,23:6,24:7,29:[1,10],30:[1,17],31:[1,18],32:[1,20],33:[1,21],34:[1,22],35:[1,19],38:[1,23]},{1:[2,43],15:[2,43],16:[2,43],21:[2,43],29:[2,43]},{13:[1,49]},{4:50,5:9,6:12,7:[1,13],8:[1,14],9:4,14:11,17:8,18:15,19:[1,16],20:3,22:5,23:6,24:7,29:[1,10],30:[1,17],31:[1,18],32:[1,20],33:[1,21],34:[1,22],35:[1,19],38:[1,23]},{14:51,18:15,19:[1,16],38:[1,23]},{4:52,5:9,6:12,7:[1,13],8:[1,14],9:4,14:11,17:8,18:15,19:[1,16],20:3,22:5,23:6,24:7,29:[1,10],30:[1,17],31:[1,18],32:[1,20],33:[1,21],34:[1,22],35:[1,19],38:[1,23]},{14:53,18:15,19:[1,16],38:[1,23]},{6:54,30:[1,17],31:[1,18],32:[1,20],33:[1,21],34:[1,22],35:[1,19]},{30:[1,56],31:[1,57],32:[1,58],33:[1,59],34:[1,60],35:[1,55]},{6:61,30:[1,17],31:[1,18],32:[1,20],33:[1,21],34:[1,22],35:[1,19]},{1:[2,5],8:[2,5],10:[2,5],13:[2,5],15:[2,5],16:[2,5],21:[2,5]},{1:[2,6],8:[2,6],10:[2,6],13:[2,6],15:[2,6],16:[2,6],21:[2,6]},{1:[2,51],10:[2,51],11:[2,51],13:[2,51],15:[2,51],16:[2,51],21:[2,51],27:[2,51],29:[2,51]},{1:[2,18],16:[2,18],21:[2,18]},{1:[2,9],10:[2,9],13:[2,9],15:[2,9],16:[2,9],21:[2,9]},{11:[1,62],13:[1,63]},{11:[2,24],13:[2,24]},{26:[1,64],28:[1,65]},{1:[2,11],10:[2,11],13:[2,11],15:[2,11],16:[2,11],21:[2,11]},{16:[1,66],21:[1,24]},{16:[1,67],21:[1,24]},{37:[1,68]},{16:[1,69],21:[1,24]},{1:[2,39],13:[2,39],15:[2,39],16:[2,39],21:[2,39]},{16:[1,70],21:[1,24]},{1:[2,14],13:[2,14],16:[2,14],21:[2,14]},{1:[2,7],8:[2,7],10:[2,7],13:[2,7],15:[2,7],16:[2,7],21:[2,7]},{13:[1,71]},{13:[1,72]},{13:[1,73]},{13:[1,74]},{13:[1,75]},{1:[2,38],13:[2,38],15:[2,38],16:[2,38],21:[2,38]},{1:[2,4],8:[2,4],10:[2,4],13:[2,4],15:[2,4],16:[2,4],21:[2,4]},{1:[2,10],10:[2,10],13:[2,10],15:[2,10],16:[2,10],21:[2,10]},{6:45,25:76,30:[1,17],31:[1,18],32:[1,20],33:[1,21],34:[1,22],35:[1,19]},{6:77,18:78,19:[1,79],30:[1,17],31:[1,18],32:[1,20],33:[1,21],34:[1,22],35:[1,19],38:[1,23]},{6:45,25:80,30:[1,17],31:[1,18],32:[1,20],33:[1,21],34:[1,22],35:[1,19]},{1:[2,12],10:[2,12],13:[2,12],15:[2,12],16:[2,12],21:[2,12]},{1:[2,42],15:[2,42],16:[2,42],21:[2,42],29:[2,42]},{15:[1,81]},{1:[2,37],15:[2,37],16:[2,37],21:[2,37]},{1:[2,40],13:[2,40],15:[2,40],16:[2,40],21:[2,40]},{18:82,38:[1,23]},{18:84,19:[1,83],38:[1,23]},{18:85,38:[1,23]},{18:86,38:[1,23]},{18:87,38:[1,23]},{11:[2,25],13:[2,25]},{11:[2,26],13:[2,26],27:[1,88]},{11:[2,27],13:[2,27],27:[1,89]},{11:[2,30],13:[2,30]},{11:[2,31],13:[2,31]},{4:90,5:9,6:12,7:[1,13],8:[1,14],9:4,14:11,17:8,18:15,19:[1,16],20:3,22:5,23:6,24:7,29:[1,10],30:[1,17],31:[1,18],32:[1,20],33:[1,21],34:[1,22],35:[1,19],38:[1,23]},{1:[2,41],15:[2,41],16:[2,41],21:[2,41],29:[2,41]},{1:[2,32],15:[2,32],16:[2,32],21:[2,32]},{1:[2,33],15:[2,33],16:[2,33],21:[2,33]},{1:[2,34],15:[2,34],16:[2,34],21:[2,34]},{1:[2,35],15:[2,35],16:[2,35],21:[2,35]},{1:[2,36],15:[2,36],16:[2,36],21:[2,36]},{11:[2,28],13:[2,28]},{11:[2,29],13:[2,29]},{16:[1,91],21:[1,24]},{1:[2,44],15:[2,44],16:[2,44],21:[2,44],29:[2,44]}],defaultActions:{},parseError:function(t,n){throw new Error(t)},parse:function(t){function v(e){r.length=r.length-2*e,i.length=i.length-e,s.length=s.length-e}function m(){var e;return e=n.lexer.lex()||1,typeof e!="number"&&(e=n.symbols_[e]||e),e}var n=this,r=[0],i=[null],s=[],o=this.table,u="",a=0,f=0,l=0,c=2,h=1;this.lexer.setInput(t),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,typeof this.lexer.yylloc=="undefined"&&(this.lexer.yylloc={});var p=this.lexer.yylloc;s.push(p);var d=this.lexer.options&&this.lexer.options.ranges;typeof this.yy.parseError=="function"&&(this.parseError=this.yy.parseError);var g,y,b,w,E,S,x={},T,N,C,k;for(;;){b=r[r.length-1];if(this.defaultActions[b])w=this.defaultActions[b];else{if(g===null||typeof g=="undefined")g=m();w=o[b]&&o[b][g]}if(typeof w=="undefined"||!w.length||!w[0])var L="";if(w[0]instanceof Array&&w.length>1)throw new Error("Parse Error: multiple actions possible at state: "+b+", token: "+g);switch(w[0]){case 1:r.push(g),i.push(this.lexer.yytext),s.push(this.lexer.yylloc),r.push(w[1]),g=null,y?(g=y,y=null):(f=this.lexer.yyleng,u=this.lexer.yytext,a=this.lexer.yylineno,p=this.lexer.yylloc,l>0&&l--);break;case 2:N=this.productions_[w[1]][1],x.$=i[i.length-N],x._$={first_line:s[s.length-(N||1)].first_line,last_line:s[s.length-1].last_line,first_column:s[s.length-(N||1)].first_column,last_column:s[s.length-1].last_column},d&&(x._$.range=[s[s.length-(N||1)].range[0],s[s.length-1].range[1]]),S=this.performAction.call(x,u,f,a,this.yy,w[1],i,s);if(typeof S!="undefined")return S;N&&(r=r.slice(0,-1*N*2),i=i.slice(0,-1*N),s=s.slice(0,-1*N)),r.push(this.productions_[w[1]][0]),i.push(x.$),s.push(x._$),C=o[r[r.length-2]][r[r.length-1]],r.push(C);break;case 3:return!0}}return!0}};return t.prototype=e,e.Parser=t,new t}();typeof require!="undefined"&&typeof exports!="undefined"&&(exports.parser=t,exports.Parser=t.Parser,exports.parse=function(){return t.parse.apply(t,arguments)},exports.main=function(t){if(!t[1])throw new Error("Usage: "+t[0]+" FILE");var n,r;return typeof process!="undefined"?n=require("fs").readFileSync(require("path").resolve(t[1]),"utf8"):n=require("file").path(require("file").cwd()).join(t[1]).read({charset:"utf-8"}),exports.parser.parse(n)},typeof module!="undefined"&&require.main===module&&exports.main(typeof process!="undefined"?process.argv.slice(1):require("system").args));var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$={}.hasOwnProperty,J=[].slice,K=function(e,t){function r(){this.constructor=e}for(var n in t)$.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},Q=function(e,t){return function(){return e.apply(t,arguments)}},G=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};V={async:!1},L=Object.defineProperty,U=["undefined","boolean","number","string"],O=function(e,t){return L(e,t,{get:function(){var e;return this.hasOwnProperty("_"+t)||(e=t in Object.getPrototypeOf(this)?Object.create(Object.getPrototypeOf(this)[t]):{},L(this,"_"+t,{configurable:!0,writable:!0,value:e})),this["_"+t]}})},_=function(e,t,n){var r,i;n==null&&(n=!0);for(r in t){if(!$.call(t,r))continue;i=t[r],n?e[r]=i:L(e,r,{value:i,configurable:!0})}return e},N=function(e,t,n){if(e[t]!==n)return e[t]=n},I=function(e,t,n){return n==null&&(n=!0),_(_({},e,n),t,n)},D=function(e,t){return e[t+"_property"]?e[t+"_property"].format():e[t]},j=function(e){return Object.prototype.toString.call(e)==="[object Array]"},R=function(e,t){var n;return n={},n[e]=t,n},X=function(e){var t,n,r,i;if(e&&typeof e.toJSON=="function")return e.toJSON();if(j(e)){i=[];for(n=0,r=e.length;n<r;n++)t=e[n],i.push(X(t));return i}return e},C=function(e){return e.slice(0,1).toUpperCase()+e.slice(1)},H=function(e){var t;return t=e instanceof Object?("_s_hash"in e?void 0:L(e,"_s_hash",{value:++arguments.callee.current}),e._s_hash):e,typeof e+" "+t},H.current=0,W=function(e,t,n){if(!e[t]||e[t].indexOf(n)===-1)return e.hasOwnProperty(t)?e[t].push(n):e[t]?L(e,t,{value:[n].concat(e[t])}):L(e,t,{value:[n]})},z=function(e,t,n){var r;if(e[t]&&(r=e[t].indexOf(n))!==-1)return e.hasOwnProperty(t)||L(e,t,{value:[].concat(e[t])}),e[t].splice(r,1)},d=function(){function e(e){var t,n,r,i;this.map={};for(n=r=0,i=e.length;r<i;n=++r)t=e[n],this.put(n,t)}return e.prototype.isMember=function(e){var t;return((t=this.map[H(e)])!=null?t[0].length:void 0)>0},e.prototype.indexOf=function(e){var t,n;return(t=this.map[H(e)])!=null?(n=t[0])!=null?n[0]:void 0:void 0},e.prototype.put=function(e,t){var n;return n=this.map[H(t)],this.map[H(t)]=n?[n[0].concat(e).sort(function(e,t){return e-t}),t]:[[e],t]},e.prototype.remove=function(e){var t,n;return(n=this.map[H(e)])!=null?typeof (t=n[0]).shift=="function"?t.shift():void 0:void 0},e}(),S=function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,v,m,g,y,b,w;e==null&&(e=[]),t==null&&(t=[]),c=[],t=t.map(function(e){return e}),h=new d(t),r=[];for(v=0,y=e.length;v<y;v++)u=e[v],h.isMember(u)?r.push(u):c.push({type:"remove",index:r.length}),h.remove(u);s=[].concat(r),i=new d(r);for(a=m=0,b=t.length;m<b;a=++m)u=t[a],i.isMember(u)||(c.push({type:"insert",index:a,value:u}),s.splice(a,0,u)),i.remove(u);o=new d(s);for(f=g=0,w=s.length;g<w;f=++g)n=s[f],p=t[f],n!==p?(l=o.indexOf(p),o.remove(n),o.remove(p),o.put(l,n),s[f]=p,s[l]=n,c.push({type:"swap",index:f,"with":l})):o.remove(n);return c},a=function(){function e(e,t,n){this.object=e,this.name=t,this.options=n}return L(e.prototype,"async",{get:function(){return"async"in this.options?this.options.async:V.async}}),e.prototype.trigger=function(){var e,t,n=this;e=1<=arguments.length?J.call(arguments,0):[];if(this.listeners.length){this.queue.push(e);if(this.async){if(this.options.animate)return(t=this.queue).frame||(t.frame=requestAnimationFrame(function(){return n.resolve()},this.options.timeout||0));if(this.queue.timeout&&!this.options.buffer)return;return clearTimeout(this.queue.timeout),this.queue.timeout=setTimeout(function(){return n.resolve()},this.options.timeout||0)}return this.resolve()}},e.prototype.bind=function(e){return this.options.bind&&this.options.bind.call(this.object,e),W(this.object._s,"listeners_"+this.name,e)},e.prototype.one=function(e){var t,n=this;return t=function(e){return n.unbind(e)},this.bind(function(){return t(arguments.callee),e.apply(this,arguments)})},e.prototype.unbind=function(e){z(this.object._s,"listeners_"+this.name,e);if(this.options.unbind)return this.options.unbind.call(this.object,e)},e.prototype.resolve=function(){var e,t,n,r,i,s=this;this.queue.frame&&cancelAnimationFrame(this.queue.frame),clearTimeout(this.queue.timeout);if(this.queue.length){t=function(e){if(s.listeners)return[].concat(s.listeners).forEach(function(t){return t.apply(s.object,e)})};if(this.options.optimize)t(this.options.optimize(this.queue));else{i=this.queue;for(n=0,r=i.length;n<r;n++)e=i[n],t(e)}}return this.queue=[]},L(e.prototype,"listeners",{get:function(){return this.object._s["listeners_"+this.name]||[]}}),L(e.prototype,"queue",{get:function(){return this.object._s.hasOwnProperty("queue_"+this.name)||(this.queue=[]),this.object._s["queue_"+this.name]},set:function(e){return this.object._s["queue_"+this.name]=e}}),e}(),A=function(e,t,n){return n==null&&(n={}),"_s"in e||O(e,"_s"),L(e,t,{configurable:!0,get:function(){return new a(this,t,n)}})},i={_identityMap:{},get:function(e,t){var n,r;n=e.uniqueId();if(n&&t)return(r=this._identityMap[n])!=null?r[t]:void 0},set:function(e,t,n){var r,i;r=e.uniqueId();if(r&&t)return(i=this._identityMap)[r]||(i[r]={}),this._identityMap[r][t]=n},unset:function(e,t){var n,r;n=e.uniqueId();if(n&&t)return(r=this._identityMap)[n]||(r[n]={}),delete this._identityMap[n][t]}},F=function(e){return(""+e).match(/^\d+$/)},s=function(){function t(e){var t,n,r,i;e==null&&(e=[]);for(t=r=0,i=e.length;r<i;t=++r)n=e[t],this[t]=n;this.length=(e!=null?e.length:void 0)||0}var e=this;return A(t.prototype,"change"),L(t.prototype,"first",{get:function(){return this[0]}}),L(t.prototype,"last",{get:function(){return this[this.length-1]}}),t.prototype.get=function(e){return this[e]},t.prototype.set=function(e,t){return this[e]=t,F(e)&&(this.length=Math.max(this.length,e+1)),t},t.prototype.update=function(e){var t,n,r,i,s;for(t in this)r=this[t],F(t)&&delete this[t];for(t=i=0,s=e.length;i<s;t=++i)n=e[t],this[t]=n;return this.length=(e!=null?e.length:void 0)||0,e},t.prototype.sortBy=function(e){return this.sort(function(t,n){return t[e]<n[e]?-1:1})},t.prototype.includes=function(e){return this.indexOf(e)>=0},t.prototype.find=function(e){var t,n,r;for(n=0,r=this.length;n<r;n++){t=this[n];if(e(t))return t}},t.prototype.insertAt=function(e,t){return Array.prototype.splice.call(this,e,0,t),t},t.prototype.deleteAt=function(e){var t;return t=this[e],Array.prototype.splice.call(this,e,1),t},t.prototype["delete"]=function(e){var t;t=this.indexOf(e);if(t!==-1)return this.deleteAt(t)},t.prototype.concat=function(){var e,n,r;return n=1<=arguments.length?J.call(arguments,0):[],n=function(){var r,i,s;s=[];for(r=0,i=n.length;r<i;r++)e=n[r],e instanceof t?s.push(e.toArray()):s.push(e);return s}(),new t((r=this.toArray()).concat.apply(r,n))},t.prototype.toArray=function(){var e,t,n;e=[];for(t in this)n=this[t],F(t)&&(e[t]=n);return e},t.prototype.clone=function(){return new t(this.toArray())},t.prototype.toString=function(){return this.toArray().toString()},t.prototype.toLocaleString=function(){return this.toArray().toLocaleString()},t.prototype.toJSON=function(){return X(this.toArray())},Object.getOwnPropertyNames(Array.prototype).forEach(function(e){var n;return(n=t.prototype)[e]||(n[e]=Array.prototype[e])}),["splice","map","filter","slice"].forEach(function(e){var n;return n=t.prototype[e],t.prototype[e]=function(){return new t(n.apply(this,arguments))}}),["push","pop","unshift","shift","splice","sort","reverse","update","set","insertAt","deleteAt"].forEach(function(e){var n;return n=t.prototype[e],t.prototype[e]=function(){var e,t;return e=this.clone(),t=n.apply(this,arguments),this.change.trigger(e,this),t}}),t}.call(this),n=function(e){function t(e,n,r){var i=this;this.owner=e,this.options=n,this._convert.apply(this,J.call(r).concat([function(){var e;return e=1<=arguments.length?J.call(arguments,0):[],t.__super__.constructor.call(i,e)}]))}return K(t,e),t.prototype.set=function(e,n){var r=this;return this._convert(n,function(n){return t.__super__.set.call(r,e,n)})},t.prototype.push=function(e){var n=this;return this._convert(e,function(e){return t.__super__.push.call(n,e)})},t.prototype.update=function(e){var n=this;return this._convert.apply(this,J.call(e).concat([function(){var e;return e=1<=arguments.length?J.call(arguments,0):[],t.__super__.update.call(n,e)}]))},t.prototype.splice=function(){var e,n,r,i=this;return r=arguments[0],e=arguments[1],n=3<=arguments.length?J.call(arguments,2):[],this._convert.apply(this,J.call(n).concat([function(){var n;return n=1<=arguments.length?J.call(arguments,0):[],t.__super__.splice.apply(i,[r,e].concat(J.call(n)))}]))},t.prototype.insertAt=function(e,n){var r=this;return this._convert(n,function(n){return t.__super__.insertAt.call(r,e,n)})},t.prototype._convert=function(){var e,t,n,r,i,s,o;n=2<=arguments.length?J.call(arguments,0,i=arguments.length-1):(i=0,[]),e=arguments[i++],n=function(){var e,r,i;i=[];for(e=0,r=n.length;e<r;e++)t=n[e],(t!=null?t.constructor:void 0)===Object&&this.options.as?i.push(t=new(this.options.as())(t)):i.push(t);return i}.call(this),r=e.apply(null,n);for(s=0,o=n.length;s<o;s++)t=n[s],this.options.inverseOf&&t[this.options.inverseOf]!==this.owner&&(t[this.options.inverseOf]=this.owner);return r},t}(s),b=function(){function e(e,t){var n,r,i;this.name=e,_(this,t),this.dependencies=[],this.localDependencies=[],this.globalDependencies=[];if(this.dependsOn){i=[].concat(this.dependsOn);for(n=0,r=i.length;n<r;n++)e=i[n],this.addDependency(e)}}return L(e.prototype,"eventOptions",{get:function(){var e,t;return e=this.name,t={timeout:this.timeout,buffer:this.buffer,animate:this.animate,bind:function(){return this[e],this[e+"_property"].registerGlobal()},optimize:function(e){var t,n;return[(t=e[0])!=null?t[0]:void 0,(n=e[e.length-1])!=null?n[1]:void 0]}},this.async!=null&&(t.async=this.async),t}}),e.prototype.addDependency=function(e){var t,n,r,i;if(this.dependencies.indexOf(e)===-1){this.dependencies.push(e),e.match(/\./)?(n="singular",r=e.split("."),e=r[0],t=r[1]):e.match(/:/)&&(n="collection",i=e.split(":"),e=i[0],t=i[1]),this.localDependencies.push(e),this.localDependencies.indexOf(e)===-1&&this.localDependencies.push(e);if(n)return this.globalDependencies.push({subname:t,name:e,type:n})}},e}(),y=function(){function t(e,t){this.definition=e,this.object=t,this.trigger=Q(this.trigger,this),this.name=this.definition.name,this.valueName="_"+this.name,this.event=new a(this.object,this.name+"_change",this.definition.eventOptions),this._gcQueue=[]}var e=this;return t.prototype.set=function(e){return typeof e=="function"?this.definition.get=e:(this.definition.set?this.definition.set.call(this.object,e):L(this.object,this.valueName,{value:e,configurable:!0}),this.trigger())},t.prototype.get=function(){var e,t,n=this;return this.definition.get&&!(this.definition.cache&&this.valueName in this.object)?(e=function(e){return n.definition.addDependency(e)},"dependsOn"in this.definition||this.object._s.property_access.bind(e),t=this.definition.get.call(this.object),"dependsOn"in this.definition||this.object._s.property_access.unbind(e),this.definition.cache&&(this.object[this.valueName]=t,this._isCached||(this._isCached=!0,this.bind(function(){})))):t=this.object[this.valueName],this.object._s.property_access.trigger(this.name),t},t.prototype.format=function(){return typeof this.definition.format=="function"?this.definition.format.call(this.object,this.get()):this.get()},t.prototype.registerGlobal=function(){var e,t,n,r,i,s,o=this;if(this._isRegistered)return;this._isRegistered=!0,this.definition.globalDependencies.forEach(function(e){var t,n,r,i,s,u,a,f;t=e.name,r=e.type,n=e.subname;switch(r){case"singular":return s=function(e,t){var r,i;return e!=null&&(r=e[n+"_property"])!=null&&r.unbind(o.trigger),t!=null?(i=t[n+"_property"])!=null?i.bind(o.trigger):void 0:void 0},(a=o.object[t+"_property"])!=null&&a.bind(s),s(void 0,o.object[t]),o._gcQueue.push(function(){var e;return s(o.object[t],void 0),(e=o.object[t+"_property"])!=null?e.unbind(s):void 0});case"collection":return u=function(e,t){return e!=null&&typeof e.forEach=="function"&&e.forEach(function(e){var t;return(t=e[n+"_property"])!=null?t.unbind(o.trigger):void 0}),t!=null?typeof t.forEach=="function"?t.forEach(function(e){var t;return(t=e[n+"_property"])!=null?t.bind(o.trigger):void 0}):void 0:void 0},i=function(e,t){var n,r,i,s;return u(e,t),e!=null&&(n=e.change)!=null&&n.unbind(o.trigger),t!=null&&(r=t.change)!=null&&r.bind(o.trigger),e!=null&&(i=e.change)!=null&&i.unbind(u),t!=null?(s=t.change)!=null?s.bind(u):void 0:void 0},(f=o.object[t+"_property"])!=null&&f.bind(i),i(void 0,o.object[t]),o._gcQueue.push(function(){var e;return i(o.object[t],void 0),(e=o.object[t+"_property"])!=null?e.unbind(i):void 0})}}),r=this.definition.localDependencies,s=[];for(t=0,n=r.length;t<n;t++)e=r[t],s.push((i=this.object[e+"_property"])!=null?i.registerGlobal():void 0);return s},t.prototype.gc=function(){var e,t,n,r,i,s,o,u,a,f,l=this;if(this.listeners.length===0&&!this.dependentProperties.find(function(e){return e.listeners.length!==0})){o=this._gcQueue;for(n=0,i=o.length;n<i;n++)t=o[n],t();this._isRegistered=!1}u=this.definition.localDependencies,f=[];for(r=0,s=u.length;r<s;r++)e=u[r],f.push((a=this.object[e+"_property"])!=null?a.gc():void 0);return f},t.prototype.trigger=function(){var e,t,n,r,i,s,o;this.clearCache();if(this.hasChanged()){n=this.get(),this.event.trigger(this._oldValue,n),e={},e[this.name]=n,(s=this.object.changed)!=null&&typeof s.trigger=="function"&&s.trigger(e),o=this.dependents;for(r=0,i=o.length;r<i;r++)t=o[r],this.object[t+"_property"].trigger();return this._oldValue=n}},["bind","one","resolve"].forEach(function(e){return t.prototype[e]=function(){var t;return(t=this.event)[e].apply(t,arguments)}}),t.prototype.unbind=function(e){return this.event.unbind(e),this.gc()},L(t.prototype,"dependents",{get:function(){var e,t,n=this;return e=[],t=function(r){var i,s,o,u,a,f;u=n.object._s.properties,f=[];for(s=0,o=u.length;s<o;s++)i=u[s],(a=i.name,G.call(e,a)<0)&&G.call(i.localDependencies,r)>=0?(e.push(i.name),f.push(t(i.name))):f.push(void 0);return f},t(this.name),e}}),L(t.prototype,"listeners",{get:function(){return this.event.listeners}}),t.prototype.clearCache=function(){if(this.definition.cache&&this.definition.get)return delete this.object[this.valueName]},t.prototype.hasChanged=function(){var e,t;return(e=this.definition.changed)===!0||e===!1?this.definition.changed:"_oldValue"in this?this.definition.changed?this.definition.changed.call(this.object,this._oldValue,this.get()):(t=typeof this._oldValue,G.call(U,t)>=0)?this._oldValue!==this.get():!0:!0},L(t.prototype,"dependentProperties",{get:function(){var e;return new E.Collection(function(){var t,n,r,i;r=this.dependents,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(this.object[e+"_property"]);return i}.call(this))}}),t}.call(this),M=function(e,t,n){var r,i;n==null&&(n={}),i=new b(t,n),"_s"in e||O(e,"_s"),W(e._s,"properties",i),A(e._s,"property_access"),L(e,t,{get:function(){return this[t+"_property"].get()},set:function(e){return this[t+"_property"].set(e)},configurable:!0,enumerable:"enumerable"in n?n.enumerable:!0}),r=t+"_property",L(e,r,{get:function(){return this._s.hasOwnProperty(r)||(this._s[r]=new y(i,this)),this._s[r]},configurable:!0}),typeof n.serialize=="string"&&M(e,n.serialize,{get:function(){return this[t]},set:function(e){return this[t]=e},configurable:!0});if("value"in n)return e[t]=n.value},B=1,v=function(){function e(e){var t;if(this.constructor.identityMap&&(e!=null?e.id:void 0)){t=i.get(this.constructor,e.id);if(t)return t.set(e),t;i.set(this.constructor,e.id,this)}this.set(e)}return e.identityMap=!0,e.find=function(e){return i.get(this,e)||new this({id:e})},e.extend=function(e){var t;return t=function(t){function n(){var t;t=n.__super__.constructor.apply(this,arguments);if(t)return t;e&&e.apply(this,arguments)}return K(n,t),n}(this)},e.property=function(){var e,t,n,r,i,s,o;t=2<=arguments.length?J.call(arguments,0,r=arguments.length-1):(r=0,[]),n=arguments[r++],typeof n=="string"&&(t.push(n),n={}),o=[];for(i=0,s=t.length;i<s;i++)e=t[i],o.push(M(this.prototype,e,n));return o},e.event=function(e,t){return A(this.prototype,e,t)},e.delegate=function(){var e,t,n,r,i=this;return e=2<=arguments.length?J.call(arguments,0,r=arguments.length-1):(r=0,[]),t=arguments[r++],n=t.to,e.forEach(function(e){var r,s;return r=e,t.prefix===!0?r=n+C(e):t.prefix&&(r=t.prefix+C(e)),t.suffix===!0?r+=C(n):t.suffix&&(r+=t.suffix),s=I(t,{dependsOn:t.dependsOn||""+n+"."+e,get:function(){var t;return(t=this[n])!=null?t[e]:void 0},set:function(t){var r;return(r=this[n])!=null?r[e]=t:void 0},format:function(){if(this[n]!=null)return E.format(this[n],e)}}),i.property(r,s)})},e.collection=function(e,t){var n;return t==null&&(t={}),n=I(t,{changed:!0,get:function(){var t;return t="_"+e,this[t]||(this[t]=new s([]),this[t].change.bind(this[e+"_property"].trigger)),this[t]},set:function(t){return this[e].update(t)}}),this.property(e,n),this.property(e+"Count",{get:function(){return this[e].length},dependsOn:e})},e.belongsTo=function(e,t){var n;return t==null&&(t={}),n=I(t,{set:function(n){var r,i;i="_"+e,n&&n.constructor===Object&&t.as&&(n=new(t.as())(n)),r=this[i],this[i]=n;if(t.inverseOf&&!n[t.inverseOf].includes(this))return r&&r[t.inverseOf]["delete"](this),n[t.inverseOf].push(this)}}),this.property(e,n),this.property(e+"Id",{get:function(){var t;return(t=this[e])!=null?t.id:void 0},set:function(n){if(n!=null)return this[e]=t.as().find(n)},dependsOn:e,serialize:t.serializeId})},e.hasMany=function(e,t){var r;return t==null&&(t={}),r=I(t,{changed:!0,get:function(){var r;return r="_"+e,this[r]||(this[r]=new n(this,t,[]),this[r].change.bind(this[e+"_property"].trigger)),this[r]},set:function(t){return this[e].update(t)}}),this.property(e,r),this.property(e+"Ids",{get:function(){return(new s(this[e])).map(function(e){return e!=null?e.id:void 0})},set:function(n){var r,i;return i=function(){var e,i,s;s=[];for(e=0,i=n.length;e<i;e++)r=n[e],s.push(t.as().find(r));return s}(),this[e].update(i)},dependsOn:e,serialize:t.serializeIds}),this.property(e+"Count",{get:function(){return this[e].length},dependsOn:e})},e.selection=function(e,t){var n;return t==null&&(t={}),n=I(t,{get:function(){return this[t.from].filter(function(e){return e[t.filter]})},dependsOn:""+t.from+":"+t.filter}),this.property(e,n),this.property(e+"Count",{get:function(){return this[e].length},dependsOn:e})},e.uniqueId=function(){if(!this._uniqueId||this._uniqueGen!==this)this._uniqueId=B+=1,this._uniqueGen=this;return this._uniqueId},e.property("id",{serialize:!0,set:function(e){return i.unset(this.constructor,this.id),i.set(this.constructor,e,this),this._s.val_id=e},get:function(){return this._s.val_id}}),e.event("saved"),e.event("changed",{optimize:function(e){var t,n,r,i;n={};for(r=0,i=e.length;r<i;r++)t=e[r],_(n,t[0]);return[n]}}),e.prototype.set=function(e){var t,n,r;r=[];for(t in e){if(!$.call(e,t))continue;n=e[t],t in this||M(this,t),r.push(this[t]=n)}return r},e.prototype.save=function(){return this.saved.trigger()},e.prototype.toJSON=function(){var e,t,n,r,i,s,o,u;n={},o=this._s.properties;for(i=0,s=o.length;i<s;i++)t=o[i],typeof t.serialize=="string"?n[t.serialize]=X(this[t.name]):typeof t.serialize=="function"?(u=t.serialize.call(this),e=u[0],r=u[1],n[e]=X(r)):t.serialize&&(n[t.name]=X(this[t.name]));return n},e.prototype.toString=function(){return JSON.stringify(this.toJSON())},e}(),f=/^[a-zA-Z][a-zA-Z0-9\-_]*/,c=/^[\[\]=\:\-!#\.@]/,w=/^"((?:\\.|[^"])*)"/,p=/^(?:\r?\n[^\r\n\S]*)+/,T=/^[^\r\n\S]+/,r=/^\s*\/\/[^\n]*/,l=["IF","ELSE","COLLECTION","IN","VIEW","UNLESS"],h=function(){function e(){}return e.prototype.tokenize=function(e,t){var n;t==null&&(t={}),this.code=e.replace(/^\s*/,"").replace(/\s*$/,""),this.line=t.line||0,this.indent=0,this.indents=[],this.ends=[],this.tokens=[],this.i=0;while(this.chunk=this.code.slice(this.i))this.i+=this.identifierToken()||this.commentToken()||this.whitespaceToken()||this.lineToken()||this.stringToken()||this.literalToken();while(n=this.ends.pop())n==="OUTDENT"?this.token("OUTDENT"):this.error("missing "+n);while(this.tokens[0][0]==="TERMINATOR")this.tokens.shift();while(this.tokens[this.tokens.length-1][0]==="TERMINATOR")this.tokens.pop();return this.tokens},e.prototype.commentToken=function(){var e;return(e=r.exec(this.chunk))?e[0].length:0},e.prototype.whitespaceToken=function(){var e;return(e=T.exec(this.chunk))?(this.token("WHITESPACE",e[0].length),e[0].length):0},e.prototype.token=function(e,t){return this.tokens.push([e,t,this.line])},e.prototype.identifierToken=function(){var e,t;return(e=f.exec(this.chunk))?(t=e[0].toUpperCase(),t==="ELSE"&&this.last(this.tokens,2)[0]==="TERMINATOR"&&this.tokens.splice(this.tokens.length-3,1),G.call(l,t)>=0?this.token(t,e[0]):this.token("IDENTIFIER",e[0]),e[0].length):0},e.prototype.stringToken=function(){var e;return(e=w.exec(this.chunk))?(this.token("STRING_LITERAL",e[1]),e[0].length):0},e.prototype.lineToken=function(){var e,t,n,r,i;if(!(n=p.exec(this.chunk)))return 0;t=n[0],this.line+=this.count(t,"\n"),r=this.last(this.tokens,1),i=t.length-1-t.lastIndexOf("\n"),e=i-this.indent;if(i===this.indent)this.newlineToken();else if(i>this.indent)this.token("INDENT"),this.indents.push(e),this.ends.push("OUTDENT");else{while(e<0)this.ends.pop(),e+=this.indents.pop(),this.token("OUTDENT");this.token("TERMINATOR","\n")}return this.indent=i,t.length},e.prototype.literalToken=function(){var e;return(e=c.exec(this.chunk))?(this.token(e[0]),1):this.error("Unexpected token '"+this.chunk.charAt(0)+"'")},e.prototype.newlineToken=function(){if(this.tag()!=="TERMINATOR")return this.token("TERMINATOR","\n")},e.prototype.tag=function(e,t){var n;return(n=this.last(this.tokens,e))&&(t?n[0]=t:n[0])},e.prototype.value=function(e,t){var n;return(n=this.last(this.tokens,e))&&(t?n[1]=t:n[1])},e.prototype.error=function(e){var t;throw t=this.code.slice(Math.max(0,this.i-10),Math.min(this.code.length,this.i+10)),SyntaxError(""+e+" on line "+(this.line+1)+" near "+JSON.stringify(t))},e.prototype.count=function(e,t){var n,r;n=r=0;if(!t.length)return 1/0;while(r=1+e.indexOf(t,r))n++;return n},e.prototype.last=function(e,t){return e[e.length-(t||0)-1]},e}(),m=function(){function e(e,t){this.ast=e,this.element=t,this.children=new s([]),this.boundClasses=new s([]),this.boundEvents=new s([])}return A(e.prototype,"load",{async:!1}),A(e.prototype,"unload",{async:!1}),e.prototype.append=function(e){return e.appendChild(this.element)},e.prototype.insertAfter=function(e){return e.parentNode.insertBefore(this.element,e.nextSibling)},e.prototype.remove=function(){var e;return this.detach(),(e=this.element.parentNode)!=null?e.removeChild(this.element):void 0},L(e.prototype,"lastElement",{configurable:!0,get:function(){return this.element}}),e.prototype.nodes=function(){return this.children},e.prototype.bindEvent=function(e,t){if(e)return this.boundEvents.push({event:e,fun:t}),e.bind(t)},e.prototype.unbindEvent=function(e,t){if(e)return this.boundEvents["delete"](t),e.unbind(t)},e.prototype.detach=function(){var e,t,n,r,i,s,o,u,a,f,l;this.unload.trigger(),u=this.nodes();for(r=0,s=u.length;r<s;r++)n=u[r],n.detach();if(this.boundEvents){a=this.boundEvents,l=[];for(i=0,o=a.length;i<o;i++)f=a[i],e=f.event,t=f.fun,l.push(e.unbind(t));return l}},e.prototype.updateClass=function(){var e;return e=this.ast.classes,this.attributeClasses&&(e=e.concat(this.attributeClasses)),this.boundClasses.length&&(e=e.concat(this.boundClasses.toArray())),e.sort(),e.length?N(this.element,"className",e.join(" ")):this.element.removeAttribute("class")},e}(),u=function(e){function t(e){this.ast=e,this.anchor=E.document.createTextNode(""),this.nodeSets=new s([]),this.boundEvents=new s([])}return K(t,e),t.prototype.nodes=function(){var e,t,n,r,i,s,o,u;t=[],u=this.nodeSets;for(r=0,s=u.length;r<s;r++){n=u[r];for(i=0,o=n.length;i<o;i++)e=n[i],t.push(e)}return t},t.prototype.rebuild=function(){var e,t,n,r,i,s;if(this.anchor.parentNode){e=this.anchor,i=this.nodes(),s=[];for(n=0,r=i.length;n<r;n++)t=i[n],t.insertAfter(e),s.push(e=t.lastElement);return s}},t.prototype.replace=function(e){var t;return this.clear(),this.nodeSets.update(function(){var n,r,i;i=[];for(n=0,r=e.length;n<r;n++)t=e[n],i.push(new s(t));return i}()),this.rebuild()},t.prototype.deleteNodeSet=function(e){var t,n,r,i;i=this.nodeSets[e];for(n=0,r=i.length;n<r;n++)t=i[n],t.remove();return this.nodeSets.deleteAt(e)},t.prototype.insertNodeSet=function(e,t){var n,r,i,o,u,a;n=((u=this.nodeSets[e-1])!=null?(a=u.last)!=null?a.lastElement:void 0:void 0)||this.anchor;for(i=0,o=t.length;i<o;i++)r=t[i],this.anchor.parentNode&&r.insertAfter(n),n=r.lastElement;return this.nodeSets.insertAt(e,new s(t))},t.prototype.swapNodeSet=function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d;n=((a=this.nodeSets[e-1])!=null?(f=a.last)!=null?f.lastElement:void 0:void 0)||this.anchor,l=this.nodeSets[t];for(i=0,o=l.length;i<o;i++)r=l[i],this.anchor.parentNode&&r.insertAfter(n),n=r.lastElement;n=((c=this.nodeSets[t-1])!=null?(h=c.last)!=null?h.lastElement:void 0:void 0)||this.anchor,p=this.nodeSets[e];for(s=0,u=p.length;s<u;s++)r=p[s],this.anchor.parentNode&&r.insertAfter(n),n=r.lastElement;return d=[this.nodeSets[t],this.nodeSets[e]],this.nodeSets[e]=d[0],this.nodeSets[t]=d[1],d},t.prototype.clear=function(){var e,t,n,r;r=this.nodes();for(t=0,n=r.length;t<n;t++)e=r[t],e.remove();return this.nodeSets.update([])},t.prototype.remove=function(){this.detach(),this.clear();if(this.anchor.parentNode)return this.anchor.parentNode.removeChild(this.anchor)},t.prototype.append=function(e){return e.appendChild(this.anchor),this.rebuild()},t.prototype.insertAfter=function(e){return e.parentNode.insertBefore(this.anchor,e.nextSibling),this.rebuild()},L(t.prototype,"lastElement",{configurable:!0,get:function(){var e,t;return((e=this.nodeSets.last)!=null?(t=e.last)!=null?t.lastElement:void 0:void 0)||this.anchor}}),t}(m),P=function(e,t){return e.bound&&e.value?D(t,e.value):e.value!=null?e.value:t},g={style:function(e,t,n,r){var i;i=function(){return N(t.element.style,e.name,P(e,n))},i();if(e.bound)return t.bindEvent(n[""+e.value+"_property"],i)},event:function(e,t,n,r){return t.element.addEventListener(e.name,function(i){return e.preventDefault&&i.preventDefault(),r[e.value](t.element,n,i)})},"class":function(e,t,n,r){var i;return i=function(){return n[e.value]?t.boundClasses.includes(e.name)||t.boundClasses.push(e.name):t.boundClasses["delete"](e.name),t.updateClass()},i(),t.bindEvent(n[""+e.value+"_property"],i)},binding:function(e,t,n,r){var i,s,o,u,a;return s=t.element,(a=t.ast.name)==="input"||a==="textarea"||a==="select"||function(){throw SyntaxError("invalid node type "+t.ast.name+" for two way binding")}(),e.value||function(){throw SyntaxError("cannot bind to whole model, please specify an attribute to bind to")}(),i=function(){return n[e.value]=s.type==="checkbox"?s.checked:s.type==="radio"?s.checked?s.getAttribute("value"):void 0:s.value},u=function(){var t;t=n[e.value];if(s.type==="checkbox")return s.checked=!!t;if(s.type!=="radio")return t===void 0&&(t=""),N(s,"value",t);if(t===s.getAttribute("value"))return s.checked=!0},u(),t.bindEvent(n[""+e.value+"_property"],u),e.name==="binding"?(o=function(e){if(s.form===(e.target||e.srcElement))return i()},E.document.addEventListener("submit",o,!0),t.unload.bind(function(){return E.document.removeEventListener("submit",o,!0)})):s.addEventListener(e.name,i)},attribute:function(e,t,n,r){var i,s;return e.name==="binding"?g.binding(e,t,n,r):(i=t.element,s=function(){var r;r=P(e,n);if(e.name==="value")return N(i,"value",r||"");if(t.ast.name==="input"&&e.name==="checked")return N(i,"checked",!!r);if(e.name==="class")return t.attributeClasses=r,t.updateClass();if(r===void 0){if(i.hasAttribute(e.name))return i.removeAttribute(e.name)}else{r===0&&(r="0");if(i.getAttribute(e.name)!==r)return i.setAttribute(e.name,r)}},e.bound&&t.bindEvent(n[""+e.value+"_property"],s),s())},on:function(e,t,n,r){var i;if((i=e.name)==="load"||i==="unload")return t[e.name].bind(function(){return r[e.value](t.element,n)});throw new SyntaxError("unkown lifecycle event '"+e.name+"'")}},o={element:function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d;s=E.document.createElement(e.name),o=new m(e,s),e.id&&s.setAttribute("id",e.id),((h=e.classes)!=null?h.length:void 0)&&s.setAttribute("class",e.classes.join(" ")),o.children=k(e.children,t,n),p=o.children;for(a=0,l=p.length;a<l;a++)i=p[a],i.append(s);d=e.properties;for(f=0,c=d.length;f<c;f++){u=d[f],r=g[u.scope];if(!r)throw SyntaxError(""+u.scope+" is not a valid scope");r(u,o,t,n)}return o.load.trigger(),o},view:function(e,t,n){var r,i,s;return i=E.controllers[e.argument],i||(s=!0,i=n),r=function(e,r,o){var u;return u=E.views[o].render(t,i,n,s),e.replace([u.nodes]),e},e.bound?this.bound(e,t,i,r):r(new u(e),void 0,e.argument)},helper:function(e,t,n){var r,i,s,o,a,f,l,c,h;s=new u(e),a=function(t,n){return t==null&&(t=t),n==null&&(n=n),(new x(null,e.children)).render(t,n)},o=E.Helpers[e.command]||function(){throw SyntaxError("no helper "+e.command+" defined")}(),i={model:t,controller:n,render:a},f=function(){var n;return n=e.arguments.map(function(e){return e.bound?t[e.value]:e.value}),s.replace([q(e,o.apply(i,n))])},h=e.arguments;for(l=0,c=h.length;l<c;l++)r=h[l],r.bound===!0&&s.bindEvent(t[""+r.value+"_property"],f);return f(),s},text:function(e,t,n){var r,i,s;return r=function(){var n;return n=P(e,t),n===0&&(n="0"),n||""},s=E.document.createTextNode(r()),i=new m(e,s),e.bound&&i.bindEvent(t[""+e.value+"_property"],function(){return N(s,"nodeValue",r())}),i},collection:function(e,t,n){var r,i,s,o,u;return i=null,r=function(t){return k(e.children,t,n)},s=[],u=function(e,t){var n,o,u,a;a=S(s,t);for(o=0,u=a.length;o<u;o++){n=a[o];switch(n.type){case"insert":i.insertNodeSet(n.index,r(n.value));break;case"remove":i.deleteNodeSet(n.index);break;case"swap":i.swapNodeSet(n.index,n["with"])}}return s=(t!=null?t.map(function(e){return e}):void 0)||[]},o=function(e,t,n){return i=e,i.unbindEvent(t!=null?t.change:void 0,u),i.bindEvent(n!=null?n.change:void 0,u),u(t,n)},this.bound(e,t,n,o)},"in":function(e,t,n){return this.bound(e,t,n,function(t,r,i){return i?t.replace([k(e.children,i,n)]):t.clear()})},"if":function(e,t,n){return this.bound(e,t,n,function(r,i,s){return s?r.replace([k(e.children,t,n)]):e["else"]?r.replace([k(e["else"].children,t,n)]):r.clear()})},unless:function(e,t,n){return this.bound(e,t,n,function(r,i,s){var o;return s?r.clear():(o=k(e.children,t,n),r.replace([o]))})},bound:function(e,t,n,r){var i,s;return i=new u(e),s=function(e,t){if(e!==t)return r(i,e,t)},s({},t[e.argument]),i.bindEvent(t[""+e.argument+"_property"],s),i}},q=function(e,t){var n;return t?(n=function(t,n){var r,i,s,o,u,a,f,l;if(typeof n=="string"){i=E.document.createElement("div"),i.innerHTML=n,f=i.childNodes;for(s=0,u=f.length;s<u;s++)r=f[s],t.push(new m(e,r))}else if(n.nodeName==="#document-fragment")if(n.nodes)t=t.concat(n.nodes);else{l=n.childNodes;for(o=0,a=l.length;o<a;o++)r=l[o],t.push(new m(e,r))}else t.push(new m(e,n));return t},[].concat(t).reduce(n,[])):[]},k=function(e,t,n){var r,i,s,u;u=[];for(i=0,s=e.length;i<s;i++)r=e[i],u.push(o[r.type](r,t,n));return u},t.lexer={lex:function(){var e,t;return t=this.tokens[this.pos++]||[""],e=t[0],this.yytext=t[1],this.yylineno=t[2],e},setInput:function(e){return this.tokens=e,this.pos=0},upcomingInput:function(){return""}},x=function(){function e(e,t){this.name=e,this.view=t}return e.prototype.parse=function(){var e;if(typeof this.view!="string")return this.view;try{return this.view=t.parse((new h).tokenize(this.view))}catch(n){throw e=n,this.name&&(e.message="In view '"+this.name+"': "+e.message),e}},e.prototype.render=function(e,t,n,r){var i,s,o,u,a;t||(t=E.controllers[this.name]||{}),typeof t=="function"&&(t=new t(e,n)),o=k(this.parse(),e,t),r||typeof t.loaded=="function"&&t.loaded.apply(t,J.call(o.map(function(e){return e.element})).concat([e])),i=E.document.createDocumentFragment();for(u=0,a=o.length;u<a;u++)s=o[u],s.append(i);return i.nodes=o,i.remove=function(){var e,t,n,r;n=this.nodes,r=[];for(e=0,t=n.length;e<t;e++)s=n[e],r.push(s.remove());return r},i},e}(),E=function(e){var t,n,r;n=Object.create(e);for(t in e)r=e[t],M(n,t,{value:r});return n},_(E,{VERSION:"0.5.0",views:{},controllers:{},document:typeof window!="undefined"&&window!==null?window.document:void 0,format:D,defineProperty:M,defineEvent:A,view:function(e,t){return t?this.views[e]=new x(e,t):new x(void 0,e)},render:function(e,t,n,r,i){return this.views[e].render(t,n,r,i)},controller:function(e,t){return this.controllers[e]=t},clearIdentityMap:function(){return i._identityMap={}},clearCache:function(){return E.clearIdentityMap()},unregisterAll:function(){return E.views={},E.controllers={}},Model:v,Collection:s,Cache:i,View:x,Helpers:{}}),L(E,"async",{get:function(){return V.async},set:function(e){return V.async=e}}),e.Serenade=E})(this)