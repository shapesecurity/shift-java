//
//  ____  _                           _
// / ___|| |_ __ _ _ __   ___  ___   (_)___  (*)
// \___ \| __/ _` | '_ \ / _ \/ __|  | / __|
//  ___) | || (_| | |_) |  __/\__ \_ | \__ \
// |____/ \__\__,_| .__/ \___||___(_)/ |___/
//              |_|              |__/
//
// (*) a (really) tiny Javascript MVC microframework
//
// (c) Hay Kranen < hay@bykr.org >
// Version 0.2 - Released under the terms of the MIT license
// < http://en.wikipedia.org/wiki/MIT_License >
//
// Stapes.js : http://hay.github.com/stapes
(function(){function f(a,b){var c=this.has(a);i._attributes[this._guid][a]=b,this.emit("change",a),this.emit("change:"+a,b);var d=c?"update":"create";this.emit(d,a),this.emit(d+":"+a,b)}function e(a,c,d,e){d=d||!1,e=e||this._guid,b.each(i._eventHandlers[e][a],b.bind(function(a){var b=a.scope?a.scope:this;d&&(a.type=d),a.scope=b,a.handler.call(a.scope,c,a)},this))}function d(a,d,e){var f={},g;typeof a=="string"?(g=e||!1,f[a]=d):(g=d||!1,f=a),b.each(f,b.bind(function(a,d){var e=d.split(" ");b.each(e,b.bind(function(b){c.call(this,{guid:this._guid,handler:a,scope:g,type:b})},this))},this))}function c(a){i._eventHandlers[a.guid][a.type]||(i._eventHandlers[a.guid][a.type]=[]),i._eventHandlers[a.guid][a.type].push({guid:a.guid,handler:a.handler,scope:a.scope,type:a.type})}var a="0.2.1",b={bind:function(a,b){return Function.prototype.bind?a.bind(b):function(){return a.apply(b,arguments)}},create:function(a){var b;if(typeof Object.create=="function")b=Object.create(a);else{var c=function(){};c.prototype=a,b=new c}b._guid=g++,i._attributes[b._guid]={},i._eventHandlers[b._guid]={};return b},each:function(a,c){if(b.isArray(a))if(Array.prototype.forEach)a.forEach(c);else for(var d=0,e=a.length;d<e;d++)c(a[d],d);else for(var f in a)c(a[f],f)},isArray:function(a){return Object.prototype.toString.call(a)==="[object Array]"},isObject:function(a){return typeof a=="object"&&!b.isArray(a)&&a!==null},makeUuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=Math.random()*16|0,c=a=="x"?b:b&3|8;return c.toString(16)})},toArray:function(a){return b.isObject(a)?b.values(a):Array.prototype.slice.call(a,0)},values:function(a){var c=[];b.each(a,function(a,b){c.push(a)});return c}},g=1,h={create:function(){return b.create(this)},emit:function(a,c){c=c||null,b.each(a.split(" "),b.bind(function(a){i._eventHandlers[-1].all&&e.call(this,"all",c,a,-1),i._eventHandlers[-1][a]&&e.call(this,a,c,a,-1),typeof this._guid=="number"&&(i._eventHandlers[this._guid].all&&e.call(this,"all",c,a),i._eventHandlers[this._guid][a]&&e.call(this,a,c))},this))},extend:function(a,c){var d=c?a:this,e=c?c:a;b.each(e,function(a,b){d[b]=a});return this},filter:function(a){var c=[];b.each(i._attributes[this._guid],function(b){a(b)&&c.push(b)});return c},get:function(a){if(typeof a=="string")return this.has(a)?i._attributes[this._guid][a]:null;if(typeof a=="function"){var b=this.filter(a);return b.length?b[0]:!1}},getAll:function(){return i._attributes[this._guid]},getAllAsArray:function(){var a=[];b.each(i._attributes[this._guid],function(c,d){b.isObject(c)&&(c.id=d),a.push(c)});return a},has:function(a){return typeof i._attributes[this._guid][a]!="undefined"},init:function(){this.emit("ready");return this},on:function(){d.apply(this,arguments)},push:function(a){b.isArray(a)?(b.each(a,b.bind(function(a){f.call(this,b.makeUuid(),a)},this)),this.emit("changemany createmany",b.toArray(a).length)):f.call(this,b.makeUuid(),a)},remove:function(a){typeof a=="function"?b.each(i._attributes[this._guid],b.bind(function(b,c){a(b)&&(delete i._attributes[this._guid][c],this.emit("remove change"))},this)):(typeof a=="string"&&(a=[a]),b.each(b.toArray(a),b.bind(function(a){this.has(a)&&(delete i._attributes[this._guid][a],this.emit("remove change"))},this)))},set:function(a,c){b.isObject(a)?(b.each(a,b.bind(function(a,b){f.call(this,b,a)},this)),this.emit("changemany",a.length)):f.call(this,a,c)},update:function(a,b){var c=this.get(a);f.call(this,a,b(c))}},i={_attributes:{},_eventHandlers:{"-1":{}},_guid:-1,create:function(){return b.create(h)},extend:function(a){b.each(a,function(a,b){h[b]=a})},on:function(){d.apply(this,arguments)},version:a};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=i),exports.Stapes=i):typeof define=="function"&&define.amd?define(function(){return i}):window.Stapes=i})()